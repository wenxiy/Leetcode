## 数据库技术

* 数据库及有关概念
* 数据模型
* **关系数据库**
* 关系代数
* SQL查询语言

### 数据库及有关概念

* 数据库所经历阶段
* 数据库特点
* 内部体系
* 外部体系
* 三个世界
* 实体型之间联系

#### 人工管理阶段

1. 主要用于计算，没有磁盘之类的直接存储设别。
2. 数据不保存，计算完成即释放。
3. 没有专门管理数据的软件。
4. 数据不能共享，数据面向程序。
5. 数据不具有独立性。依赖于应用程序

#### 文件系统阶段

1. 用于科学计算和信息管理。
2. 有磁盘，磁鼓等直接存储设备。
3. 出现文件系统：专门管理数据的软件

4. 反复利用，增删改查。
5. 有一定的共享性
6. 但仍然是面向应用的，文件之间相互独立。缺乏联系

#### 数据库系统阶段

1. 出现大容量、存储快速的磁盘。
2. 实现了数据结构化，面向全组织的所有应用
3. 共享性高、冗余度低：一组数据集合可以为多个应用和多个用户使用
4. DBNS：数据库管理系统来实现各个应用程序对数据库中的数据共享
5. 独立性高。

下面重点介绍数据库系统阶段。

### 数据库系统的特点

* 数据库结构
* 数据独立性
* 安全性控制
* 完整性控制
* 并发控制

#### 数据库结构

1. 数据库结构是指：用户的逻辑结构、数据库逻辑结构和物理结构。

#### 数据独立性

1. 数据独立性指：物理独立性和逻辑独立性。

2. 独立性都是指当改变了物理结构和逻辑结构后，用户的逻辑结构和应用程序不用改变。
3. 物理：存储结构，存取方式，外部的设备。
4. 逻辑：数据库的逻辑结构（数据类型，数据关系）

#### 安全性控制

合法用户只能操纵有权限的数据。

#### 完整性控制

设置额完整性的约束条件

####  并发控制

防止相互干扰数据库收到的损害

### 数据库系统（DBS）

利用计算机对数据库中的数据进行管理

组成：计算机硬件、数据库、软件系统（操作系统，应用程序开发系统、数据库应用系统等）、DBMS（数据库管理系统）、数据库用户。

* 数据库：将数据组成数据库形式对其进行存储、管理、处理和维护数据的高性能的信息处理系统。

* 数据库用户：对数据库进行存储、维护和检索操作
  * 非计算机专业用户：利用接口实现
  * 应用程序员：设计和编译应用，实现调试安装
  * 数据库管理员（DBA）：设计、简历、管理和维护数据库

* 软件：操作系统、数据库管理系统、应用开发工具、数据库应用系统。

  * DBMS（数据库管理系统）：

    * 定义：提供定义语言。定义数据的模式、外模式、内模式三级模式结构。

      定义模式/内模式和外模式/模式二级映像

      定义相关约束

    * 操纵：增删改查

    * 管理：安全性、完整性、并发性、数据库恢复

    * 等等


### 内部体系（三级模式结构）

应用<->外模式<->外模式/模式映像<->模式<->模式/内模式映像<->内模式<->数据库

* 模式：概念模式，是数据库中全体数据的逻辑结构和特征的描述，是数据库的整体逻辑（概念视图、概念数据库）

* 外模式：子模式或用户模式，处于最外层，用户能看到并允许使用的一部分局部数据的逻辑结构和特征描述。（用户视图、用户数据库）
  * 外模式是模式的子集，可以有多个，一个外模式可以为多个应用程序使用。
* 内模式：存储模式或物理模式。对整个数据库存储结构的描述，内部的表述方式（物理数据库、物理视图）
  * 一个数据库只有一个内模式

总结三种模式：用户根据外模式进行操作，通过映射与概念级数据库联系起来，又通过映射与物理级数据库联系到一起。

* 二级映像：DBMS在三级模式之间提供了二级映像功能，实现了数据的逻辑独立性与物理独立性

### 外部体系结构

* 单用户结构
* 主从式结构
* 分布式结构
* 客户/服务器结构、
* 浏览器/服务器结构

1. 单用户结构：桌面型数据库系统：适合未联网用户、个人用户
2. 主从式结构：大型主机带多终端的用户结构系统，又称主机/终端模式（过于依赖主机）

### 三个世界

* 现实世界
* 信息世界
* 计算机世界

图示表示更加清晰

![](https://s1.ax1x.com/2020/07/19/URfHHI.png)

* 实体：客观存在并且可以相互区分。
* 属性：实体所具有的某一特征（具有属性名和特征值）
* 实体型：具有相同属性的实体必然具有相同的特征
  * 表示方法：实体名（属性，属性）
    * eg：学生（学号，姓名）

* 实体集：同型实体的集合称为实体集（所有的组成就是实体集）
  * eg：所有学生
* 码：能够唯一标识一个实体的属性或者属性集的称为实体码
* 域：某一属性的取值范围称为这个属性的域

#### 实体型之间的联系

两个实体型之间的联系就是指不同实体集之间的联系

* 一对一联系：实体集A中的一个实体至多和实体集B中的一个联系，反之亦然
* 一对多联系：实体集A中的一个实体可以和n个B中的联系，记为1：n，反过来，实体集B中的一个实体至多和实体集A中的一个实体联系。
* 多对多联系：实体集A中的一个实体可以和n个B中的联系，反过来，实体集B中的一个实体可以和实体集A中的m个实体联系 记为m：n

#### 计算机世界所存储的数据模型

* 字段：标记实体属性的命名单位为字段，字段往往就是属性
* 记录：一个记录描述一个实体
* 文件：同一类记录的集合就是文件（实体集）
* 关键字：能唯一标识每一个字段或者字段集的就是关键字

![](https://s1.ax1x.com/2020/07/19/UW36y9.png)

* 数据模型：用来描述数据、数据联系、数据的语义和完整性约束的概念集合，由**数据结构**、**数据操作**、**完整性约束**三要素组成

* 数据结构：①描述数据库组成的对象有哪些②描述对象之间联系
  * 层次结构->层次数据库
  * 网状结构->网状数据库
  * 关系结构->关系数据库（二维表表示）
* 数据操作：动态特性，①查询类操作②更新操作（插入、删除、修改）
* 完整性约束：数据及其联系制约及其依存的规则，保证数据的正确、有效、相容

（关系模型的数据操作是集合操作，对象和结果都是关系。操作接口简单）

### **关系数据库**

#### 关系数据库的码

* 候选码：能够**唯一**标识关系中元组的一个属性和属性集（唯一性，最小性

  * eg：学生关系中，学号是候选码。
  * 选课关系中，学号+课程号(属性集)是候选码

* 主码：从候选键中选择一个作为查询、插入、删除元组的变量

  ​			被称为主关系码(唯一的

  * eg：学生关系中以学号作为数据操作的依据

* 外码：一个关系的的一个或者一组属性不是该关系的主码，但是另一个关系的主码。称为这个关系的外码，并称这个关系是参照关系。另一个关系为被参照关系

* 超码：包含候选码的属性集合

#### 关系完整性

* 实体完整性
  * 实体对于的是元组，元组的主码对应的是属性。

* 参照完整性
* 用户自定义完整性

#### 关系代数

* 抽象的查询语言
* 运算对象与运算结果都是关系
* 关系代数运算符

#### 关系演算



### SQL查询语言

* 基本表

一个关系对于一个基本表，一个或者多个基本表对应一个存储文件

* 视图

一个和几个基本表中导入的表，是一个虚表，没有存储数据，只有定义。

* 支持三级模式结构

外模式对应基本表与视图

模式对应基本表

内模式对应存储文件

* 面向集合语言、一体化语言、非过程化语言

* 数据库的结构

  * 从逻辑上来看：描述信息的数据存放在数据库中并存在数据库中由DBMS统一管理
  * 从物理上看：描述信息的数据以文件的方式存储在物理磁盘上，由操作系统进行统一管理

  * 数据文件（主要一个文件后缀.mdf,次要数据文件.ndf）、事务日志文件(.ldf)

* 创建数据库：

```sql
CREATE DATABASE 数据库名
ON
(NAME = 数据逻辑文件名,
 FILENAME = 'E:\具体盘符 \ .mdf文件',
 SIZE = 初始大小,
 MAXSIZE = 最大容量值,
 FILEGROWTH = 10 //增长方式
)
LOG ON
(
    ...与上述类似
)
```

* 修改数据库

一、对象资源管理器中右键单击要修改的数据库，点击属性，在选项卡中进行修改

二、利用sql进行修改

```sql
ALTER DATABASE 数据库名
MODIFY FILE  //修改
(NAME = 数据逻辑文件名,
FILEGROWTH = 20//具体修改项
)

```

例子：利用SQL命令修改数据库Teath,添加一个次要数据文件，逻辑名称为Teach_Datanew, 存放在E盘根目录下，文件名为Teach_Datanew.ndf。数据文件的初始大小为100MB,最大容量为200MB，文件自动增长容量为10MB

```sql
ALTER DATABASE Teach
ADD FILE(
	NAME = TEACH_Datanew,
    FILENAME = 'E:\Teach_Datanew.ndf'
    SIZE = 100,
    MAXSIZE = 200,
    FILEGROWTH = 10
)
```

删除次要文件：

```sql
ALTER DATABASE Teach
REMOVE FILE Teach_Datanew
```

* 删除数据库

一、对象资源管理器中右键单击要删除的数据库，选择删除

二、sql命令

```sql
DROP DATABASE 数据库名称
```

* 查看数据库信息

一、 对象资源管理器中，选中数据库，右击属性查看

二、 sql命令

```sql
Sp_helpdb[[@dbname=]'name']//显示数据库的结构
Sp_helpfile[[@filename]'name']//现实数据库文件信息
```

* 迁移数据库

一、

1. 分离数据库

在对象资源管理器中，选择要迁移的数据库节点，单击鼠标右键，在快捷菜单中选择“任务”，在之后的菜单中选择“分离”会弹出分离数据库的属性对话框

2. 加载数据库

在对象资源管理器中选择“数据库”节点，单击鼠标右键，在快捷菜单中选择“附加”，会弹出“附加数据库”属性对框框（选择mdf文件）

二、 生成脚本

在对象资源管理器中，选择要操作的数据库节点，单击鼠标右键，在快捷菜单中选择“任务”，在出现的菜单中选择“生成脚本”，弹出“生成和发布脚本”窗口

#### 创建和使用数据表

* 创建数据表

一、 右键单击“对象资源管理器”中的“数据库”节点下的“表”节点，从快捷菜单中选择“新建表”命令，会弹出定义数据表结构对话框，每一行用于定义数据表的一个字段，包括字段名，数据类型，字长，字段是否为null以及默认值

二、利用sql

```sql
CREATE TABLE 表名
(	字段名称 数据类型,
	字段名称 数据类型 DEFAULT '缺省值',
)
```

* 数据表的约束

  * 行约束

  * 列约束

    * 对于特定列的约束，包含在定义中，直接跟在改列的定义中，用空格分隔，不必指明列名

  * ```
    
    ```

  * 